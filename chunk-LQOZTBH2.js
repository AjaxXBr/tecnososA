import{a as j}from"./chunk-RTUFD3NC.js";import{b as me}from"./chunk-G6EORHDL.js";import{b as L}from"./chunk-G3PMQNUP.js";import{a as ne,b as ae,f as re,g as se,i as le,j as ce,s as de}from"./chunk-NPJDO2MN.js";import"./chunk-FXWHQ5QQ.js";import{$ as U,A as f,B as I,C as p,D as u,E as d,Ea as ee,F as x,G as h,Ga as te,H as F,Ha as oe,I as y,Ia as ie,J as E,K as w,L as G,N as J,Q as T,R as M,S as K,T as k,_ as Q,aa as X,ea as Y,fa as P,ga as q,i as v,m as O,ma as V,n as b,na as W,oa as A,p as H,pa as R,qa as B,ra as Z,s as r,sa as $,t as C,ta as D,w as g,wa as N,x as c,xa as z,y as o,z as i}from"./chunk-3UZMSI2G.js";import"./chunk-4EWL26LU.js";import"./chunk-KDDLO6BQ.js";import"./chunk-4EOFL5AI.js";import"./chunk-REDFVHFG.js";import"./chunk-WTJTNUM2.js";import"./chunk-6TYOTTQG.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-LRFGNCHE.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{i as _}from"./chunk-VBFW7A5V.js";function ge(a,l){if(a&1&&(o(0,"ion-select-option",11),d(1),i()),a&2){let n=l.$implicit;c("value",n.id),r(),F(" ",n.nome," - ",n.clienteNome," ")}}function fe(a,l){if(a&1&&(o(0,"ion-select-option",11),d(1),i()),a&2){let n=l.$implicit;c("value",n.value),r(),h(" ",n.label," ")}}function Se(a,l){if(a&1&&(o(0,"ion-select-option",11),d(1),i()),a&2){let n=l.$implicit;c("value",n.value),r(),h(" ",n.label," ")}}function he(a,l){a&1&&f(0,"ion-spinner",12)}var pe=(()=>{let l=class l{constructor(){this.salvo=new H,this.cancelado=new H,this.osService=v(j),this.equipamentoService=v(me),this.alertService=v(L),this.form={equipamentoId:"",defeitoRelatado:"",observacoesTecnicas:"",status:"aguardando",prioridade:"media"},this.equipamentos=[],this.carregando=!1,this.editando=!1,this.statusOptions=[{value:"aguardando",label:"Aguardando"},{value:"em_reparo",label:"Em Reparo"},{value:"pronto",label:"Pronto"},{value:"cancelado",label:"Cancelado"}],this.prioridadeOptions=[{value:"baixa",label:"Baixa"},{value:"media",label:"M\xE9dia"},{value:"alta",label:"Alta"}]}ngOnInit(){return _(this,null,function*(){this.carregarEquipamentos(),this.os&&(this.editando=!0,this.form={equipamentoId:this.os.equipamentoId,defeitoRelatado:this.os.defeitoRelatado,observacoesTecnicas:this.os.observacoesTecnicas,status:this.os.status,prioridade:this.os.prioridade})})}carregarEquipamentos(){return _(this,null,function*(){try{this.equipamentoService.obterEquipamentos().subscribe(t=>{this.equipamentos=t})}catch{yield this.alertService.showError("Erro ao carregar equipamentos")}})}salvar(){return _(this,null,function*(){if(console.log("\u{1F504} Tentando salvar OS...",this.form),this.validarFormulario()){this.carregando=!0,console.log("\u2705 Formul\xE1rio OS v\xE1lido, salvando...");try{this.editando&&this.os?.id?(console.log("\u270F\uFE0F Editando OS existente:",this.os.id),yield this.osService.atualizarOS(this.os.id,this.form),yield this.alertService.showSuccess("OS atualizada com sucesso!")):(console.log("\u2795 Adicionando nova OS"),yield this.osService.adicionarOS(this.form),yield this.alertService.showSuccess("OS cadastrada com sucesso!")),console.log("\u2705 OS salva com sucesso"),this.salvo.emit(),this.limparFormulario()}catch(t){console.error("\u274C Erro ao salvar OS:",t),yield this.alertService.showError("Erro ao salvar OS: "+t.message)}finally{this.carregando=!1,console.log("\u{1F3C1} Processo de salvamento OS finalizado")}}else console.log("\u274C Formul\xE1rio OS inv\xE1lido")})}cancelar(){this.cancelado.emit(),this.limparFormulario()}validarFormulario(){return this.form.equipamentoId?!this.form.defeitoRelatado||this.form.defeitoRelatado.trim().length<5?(this.alertService.showError("Defeito relatado deve ter pelo menos 5 caracteres"),!1):!0:(this.alertService.showError("Equipamento \xE9 obrigat\xF3rio"),!1)}limparFormulario(){this.form={equipamentoId:"",defeitoRelatado:"",observacoesTecnicas:"",status:"aguardando",prioridade:"media"},this.editando=!1}};l.\u0275fac=function(s){return new(s||l)},l.\u0275cmp=C({type:l,selectors:[["app-os-form"]],inputs:{os:"os"},outputs:{salvo:"salvo",cancelado:"cancelado"},decls:36,vars:18,consts:[["slot","end"],[3,"click","disabled"],["position","stacked"],["placeholder","Selecione o equipamento",3,"ngModelChange","ngModel","disabled"],[3,"value",4,"ngFor","ngForOf"],["placeholder","Descreva o defeito relatado pelo cliente","rows","3",3,"ngModelChange","ngModel","disabled"],["placeholder","Descreva as observa\xE7\xF5es t\xE9cnicas","rows","3",3,"ngModelChange","ngModel","disabled"],[3,"ngModelChange","ngModel","disabled"],[1,"ion-padding"],["expand","block","color","primary",3,"click","disabled"],["slot","start",4,"ngIf"],[3,"value"],["slot","start"]],template:function(s,e){s&1&&(o(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),d(3),i(),o(4,"ion-buttons",0)(5,"ion-button",1),p("click",function(){return e.cancelar()}),d(6,"Cancelar"),i()()()(),o(7,"ion-content")(8,"ion-list")(9,"ion-item")(10,"ion-label",2),d(11,"Equipamento *"),i(),o(12,"ion-select",3),w("ngModelChange",function(m){return E(e.form.equipamentoId,m)||(e.form.equipamentoId=m),m}),g(13,ge,2,3,"ion-select-option",4),i()(),o(14,"ion-item")(15,"ion-label",2),d(16,"Defeito Relatado *"),i(),o(17,"ion-textarea",5),w("ngModelChange",function(m){return E(e.form.defeitoRelatado,m)||(e.form.defeitoRelatado=m),m}),i()(),o(18,"ion-item")(19,"ion-label",2),d(20,"Observa\xE7\xF5es T\xE9cnicas"),i(),o(21,"ion-textarea",6),w("ngModelChange",function(m){return E(e.form.observacoesTecnicas,m)||(e.form.observacoesTecnicas=m),m}),i()(),o(22,"ion-item")(23,"ion-label",2),d(24,"Status"),i(),o(25,"ion-select",7),w("ngModelChange",function(m){return E(e.form.status,m)||(e.form.status=m),m}),g(26,fe,2,2,"ion-select-option",4),i()(),o(27,"ion-item")(28,"ion-label",2),d(29,"Prioridade"),i(),o(30,"ion-select",7),w("ngModelChange",function(m){return E(e.form.prioridade,m)||(e.form.prioridade=m),m}),g(31,Se,2,2,"ion-select-option",4),i()()(),o(32,"div",8)(33,"ion-button",9),p("click",function(){return e.salvar()}),g(34,he,1,0,"ion-spinner",10),d(35),i()()()),s&2&&(r(3),x(e.editando?"Editar OS":"Nova OS"),r(2),c("disabled",e.carregando),r(7),y("ngModel",e.form.equipamentoId),c("disabled",e.carregando),r(),c("ngForOf",e.equipamentos),r(4),y("ngModel",e.form.defeitoRelatado),c("disabled",e.carregando),r(4),y("ngModel",e.form.observacoesTecnicas),c("disabled",e.carregando),r(4),y("ngModel",e.form.status),c("disabled",e.carregando),r(),c("ngForOf",e.statusOptions),r(4),y("ngModel",e.form.prioridade),c("disabled",e.carregando),r(),c("ngForOf",e.prioridadeOptions),r(2),c("disabled",e.carregando),r(),c("ngIf",e.carregando),r(),h(" ",e.editando?"Atualizar":"Criar"," OS "))},dependencies:[k,T,M,X,Q,U,V,W,z,N,q,P,B,A,R,oe,$,D,ie],encapsulation:2});let a=l;return a})();function ve(a,l){if(a&1){let n=I();o(0,"ion-button",20),p("click",function(){O(n);let s=u().$implicit,e=u();return b(e.avancarStatus(s))}),f(1,"ion-icon",21),i()}}function Oe(a,l){if(a&1){let n=I();o(0,"ion-item")(1,"ion-avatar",13),f(2,"ion-icon",14),i(),o(3,"ion-label")(4,"h2"),d(5),i(),o(6,"p"),d(7),i(),o(8,"p"),d(9),i(),o(10,"p"),d(11),G(12,"date"),i()(),o(13,"ion-buttons",2),g(14,ve,2,0,"ion-button",15),o(15,"ion-button",16),p("click",function(){let s=O(n).$implicit,e=u();return b(e.editarOS(s))}),f(16,"ion-icon",17),i(),o(17,"ion-button",18),p("click",function(){let s=O(n).$implicit,e=u();return b(e.excluirOS(s))}),f(18,"ion-icon",19),i()()()}if(a&2){let n=l.$implicit,t=u();r(2),c("name",t.getIconeStatus(n.status))("color",t.getCorStatus(n.status)),r(3),F("",n.numero," - ",n.equipamentoNome,""),r(2),x(n.defeitoRelatado),r(2),h("Cliente: ",n.clienteNome,""),r(2),h("Data: ",J(12,8,n.dataAbertura,"dd/MM/yyyy"),""),r(3),c("ngIf",n.status!=="pronto"&&n.status!=="cancelado")}}function be(a,l){a&1&&(o(0,"div",22),f(1,"ion-spinner"),o(2,"p"),d(3,"Carregando ordens de servi\xE7o..."),i()())}function ye(a,l){if(a&1){let n=I();o(0,"div",22)(1,"p"),d(2),i(),o(3,"ion-button",3),p("click",function(){O(n);let s=u();return b(s.novaOS())}),d(4,"Criar Primeira OS"),i()()}if(a&2){let n=u();r(2),h("Nenhuma ordem de servi\xE7o ",n.getTextoStatus(),"")}}function Ee(a,l){if(a&1){let n=I();o(0,"app-os-form",23),p("salvo",function(){O(n);let s=u();return b(s.onOSSalva())})("cancelado",function(){O(n);let s=u();return b(s.onOSCancelada())}),i()}if(a&2){let n=u();c("os",n.osEditando)}}var Je=(()=>{let l=class l{constructor(){this.osService=v(j),this.alertService=v(L),this.ordensServico=[],this.ordensFiltradas=[],this.carregando=!1,this.mostrarFormulario=!1,this.segmentoAtivo="aguardando",ne({add:ae,create:le,trash:de,eye:ce,checkmark:re,close:se})}ngOnInit(){this.carregarOS()}carregarOS(){return _(this,null,function*(){this.carregando=!0;try{this.osService.obterOS().subscribe({next:t=>{this.ordensServico=t,this.filtrarOS(),this.carregando=!1},error:t=>_(this,null,function*(){yield this.alertService.showError("Erro ao carregar ordens de servi\xE7o"),this.carregando=!1})})}catch{yield this.alertService.showError("Erro ao carregar ordens de servi\xE7o"),this.carregando=!1}})}filtrarOS(){this.ordensFiltradas=this.ordensServico.filter(t=>t.status===this.segmentoAtivo)}mudarSegmento(t){this.segmentoAtivo=t.detail.value,this.filtrarOS()}novaOS(){this.osEditando=void 0,this.mostrarFormulario=!0}editarOS(t){this.osEditando=t,this.mostrarFormulario=!0}excluirOS(t){return _(this,null,function*(){if((yield this.alertService.showConfirm("Confirmar Exclus\xE3o",`Deseja realmente excluir a OS ${t.numero}?`))&&t.id)try{yield this.osService.excluirOS(t.id),yield this.alertService.showSuccess("OS exclu\xEDda com sucesso!"),this.carregarOS()}catch(e){yield this.alertService.showError("Erro ao excluir OS: "+e.message)}})}atualizarStatusOS(t,s){return _(this,null,function*(){if(t.id)try{yield this.osService.atualizarStatusOS(t.id,s),yield this.alertService.showSuccess("Status atualizado com sucesso!"),this.carregarOS()}catch(e){yield this.alertService.showError("Erro ao atualizar status: "+e.message)}})}getIconeStatus(t){return{aguardando:"time",em_reparo:"construct",pronto:"checkmark-circle",cancelado:"close-circle"}[t]}getCorStatus(t){return{aguardando:"warning",em_reparo:"primary",pronto:"success",cancelado:"danger"}[t]}avancarStatus(t){let e={aguardando:"em_reparo",em_reparo:"pronto",pronto:"pronto",cancelado:"cancelado"}[t.status];this.atualizarStatusOS(t,e)}getTextoStatus(){return{aguardando:"em espera",em_reparo:"em reparo",pronto:"prontas",cancelado:"canceladas"}[this.segmentoAtivo]}onOSSalva(){this.mostrarFormulario=!1,this.osEditando=void 0,this.carregarOS()}onOSCancelada(){this.mostrarFormulario=!1,this.osEditando=void 0}};l.\u0275fac=function(s){return new(s||l)},l.\u0275cmp=C({type:l,selectors:[["app-os"]],decls:23,vars:7,consts:[[3,"translucent"],["color","primary"],["slot","end"],[3,"click"],["slot","icon-only","name","add"],[3,"fullscreen"],[3,"ionChange","value"],["value","aguardando"],["value","em_reparo"],["value","pronto"],[4,"ngFor","ngForOf"],["class","ion-text-center ion-padding",4,"ngIf"],[3,"os","salvo","cancelado",4,"ngIf"],["slot","start"],[3,"name","color"],["fill","clear","color","success",3,"click",4,"ngIf"],["fill","clear","color","warning",3,"click"],["slot","icon-only","name","create"],["fill","clear","color","danger",3,"click"],["slot","icon-only","name","trash"],["fill","clear","color","success",3,"click"],["slot","icon-only","name","checkmark"],[1,"ion-text-center","ion-padding"],[3,"salvo","cancelado","os"]],template:function(s,e){s&1&&(o(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),d(3,"Ordens de Servi\xE7o"),i(),o(4,"ion-buttons",2)(5,"ion-button",3),p("click",function(){return e.novaOS()}),f(6,"ion-icon",4),i()()()(),o(7,"ion-content",5)(8,"ion-segment",6),p("ionChange",function(m){return e.mudarSegmento(m)}),o(9,"ion-segment-button",7)(10,"ion-label"),d(11,"Aguardando"),i()(),o(12,"ion-segment-button",8)(13,"ion-label"),d(14,"Em Reparo"),i()(),o(15,"ion-segment-button",9)(16,"ion-label"),d(17,"Pronto"),i()()(),o(18,"ion-list"),g(19,Oe,19,11,"ion-item",10),i(),g(20,be,4,0,"div",11)(21,ye,5,1,"div",11)(22,Ee,1,1,"app-os-form",12),i()),s&2&&(c("translucent",!0),r(7),c("fullscreen",!0),r(),c("value",e.segmentoAtivo),r(11),c("ngForOf",e.ordensFiltradas),r(),c("ngIf",e.carregando),r(),c("ngIf",e.ordensFiltradas.length===0&&!e.carregando),r(),c("ngIf",e.mostrarFormulario))},dependencies:[k,T,M,K,W,z,N,q,P,V,B,A,R,ee,Y,te,Z,pe,D],encapsulation:2});let a=l;return a})();export{Je as OSPage};
