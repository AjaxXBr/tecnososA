import{a as m}from"./chunk-G3PMQNUP.js";import{a as C,c as b,d as h,e as u,i as l}from"./chunk-3UZMSI2G.js";import{a as c,b as s,i as n}from"./chunk-VBFW7A5V.js";var w=(()=>{let r=class r{constructor(){this.colecao="clientes",this.baseCrud=l(m)}obterClientes(){return console.log("\u{1F4D6} Buscando todos os clientes"),this.baseCrud.obterTodos(this.colecao)}obterClientePorId(e){return this.baseCrud.obterPorId(this.colecao,e)}adicionarCliente(e){return n(this,null,function*(){if(!e.nome||e.nome.trim().length<3)throw new Error("Nome do cliente deve ter pelo menos 3 caracteres");let o=s(c({},e),{dataCriacao:new Date});return this.baseCrud.adicionar(this.colecao,o)})}atualizarCliente(e,o){return n(this,null,function*(){if(!o.nome||o.nome.trim().length<3)throw new Error("Nome do cliente deve ter pelo menos 3 caracteres");let t=s(c({},o),{dataAtualizacao:new Date});return this.baseCrud.atualizar(this.colecao,e,t)})}excluirCliente(e){return n(this,null,function*(){return this.baseCrud.excluir(this.colecao,e)})}validarEmailUnico(e,o){return new C(t=>{this.obterClientes().subscribe({next:i=>{let f=o?i.filter(d=>d.id!==o&&d.email===e):i.filter(d=>d.email===e);t.next(f.length===0),t.complete()},error:i=>{t.error(i)}})})}};r.\u0275fac=function(o){return new(o||r)},r.\u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();var z=(()=>{let r=class r{constructor(){this.colecao="equipamentos",this.baseCrud=l(m),this.clienteService=l(w)}adicionarEquipamento(e){return n(this,null,function*(){if(console.log("\u{1F504} Iniciando cadastro de equipamento...",e),!e.nome||e.nome.trim().length<2)throw new Error("Nome do equipamento deve ter pelo menos 2 caracteres");if(!e.clienteId)throw new Error("Cliente \xE9 obrigat\xF3rio");try{let o=yield b(this.clienteService.obterClientePorId(e.clienteId));if(!o)throw new Error("Cliente n\xE3o encontrado");let t=s(c({},e),{clienteNome:o.nome,dataAquisicao:new Date(e.dataAquisicao),dataCriacao:new Date});console.log("\u2705 Equipamento completo para salvar:",t);let i=yield this.baseCrud.adicionar(this.colecao,t);return console.log("\u2705 Equipamento salvo com ID:",i),i}catch(o){throw console.error("\u274C Erro ao adicionar equipamento:",o),o}})}obterEquipamentos(){return this.baseCrud.obterTodos(this.colecao)}obterEquipamentosPorCliente(e){return this.baseCrud.obterComFiltro(this.colecao,"clienteId",e)}obterEquipamentoPorId(e){return this.baseCrud.obterPorId(this.colecao,e)}atualizarEquipamento(e,o){return n(this,null,function*(){if(!o.nome||o.nome.trim().length<2)throw new Error("Nome do equipamento deve ter pelo menos 2 caracteres");if(!o.clienteId)throw new Error("Cliente \xE9 obrigat\xF3rio");let t=yield this.clienteService.obterClientePorId(o.clienteId).toPromise();if(!t)throw new Error("Cliente n\xE3o encontrado");let i=s(c({},o),{clienteNome:t.nome,dataAquisicao:new Date(o.dataAquisicao)});return this.baseCrud.atualizar(this.colecao,e,i)})}excluirEquipamento(e){return this.baseCrud.excluir(this.colecao,e)}validarNumeroSerieUnico(e,o){return this.baseCrud.obterComFiltro(this.colecao,"numeroSerie",e).pipe(h(t=>o?t.filter(i=>i.id!==o).length===0:t.length===0))}buscarEquipamentos(e){return this.obterEquipamentos().pipe(h(o=>o.filter(t=>t.nome.toLowerCase().includes(e.toLowerCase())||t.numeroSerie.toLowerCase().includes(e.toLowerCase())||t.clienteNome.toLowerCase().includes(e.toLowerCase())).slice(0,10)))}};r.\u0275fac=function(o){return new(o||r)},r.\u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();export{w as a,z as b};
