import{a as p,b}from"./chunk-G6EORHDL.js";import{a as S}from"./chunk-G3PMQNUP.js";import{c as u,d as m,e as h,i as s}from"./chunk-3UZMSI2G.js";import{a as l,b as d,i as n}from"./chunk-VBFW7A5V.js";var q=(()=>{let r=class r{constructor(){this.colecao="ordens-servico",this.baseCrud=s(S),this.equipamentoService=s(b),this.clienteService=s(p)}adicionarOS(t){return n(this,null,function*(){console.log("\u{1F504} Iniciando cadastro de OS...",t);let e=yield this.gerarNumeroOS(),o=yield u(this.equipamentoService.obterEquipamentoPorId(t.equipamentoId));if(!o)throw new Error("Equipamento n\xE3o encontrado");let a=d(l({},t),{numero:e,equipamentoNome:o.nome,clienteId:o.clienteId,clienteNome:o.clienteNome,dataAbertura:new Date,valorTotal:0});return console.log("\u2705 OS completa para salvar:",a),this.baseCrud.adicionar(this.colecao,a)})}obterOS(){return this.baseCrud.obterTodos(this.colecao)}obterOSPorStatus(t){return this.baseCrud.obterComFiltro(this.colecao,"status",t)}obterOSPorId(t){return this.baseCrud.obterPorId(this.colecao,t)}obterOSPorCliente(t){return this.baseCrud.obterComFiltro(this.colecao,"clienteId",t)}atualizarOS(t,e){return this.baseCrud.atualizar(this.colecao,t,e)}atualizarStatusOS(t,e){return n(this,null,function*(){let o={status:e};return e==="pronto"&&(o.dataConclusao=new Date),this.baseCrud.atualizar(this.colecao,t,o)})}excluirOS(t){return this.baseCrud.excluir(this.colecao,t)}gerarNumeroOS(){return n(this,null,function*(){let t=new Date,e=t.getFullYear(),o=(t.getMonth()+1).toString().padStart(2,"0"),a=yield u(this.obterOSDoMes(e,o)),i=a?a.length+1:1;return`OS${e}${o}${i.toString().padStart(3,"0")}`})}obterOSDoMes(t,e){return this.obterOS().pipe(m(o=>o.filter(a=>{let i=new Date(a.dataAbertura);return i.getFullYear()===t&&(i.getMonth()+1).toString().padStart(2,"0")===e})))}};r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"});let c=r;return c})();export{q as a};
